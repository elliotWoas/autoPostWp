# Flowcharts and Diagrams

## Main Application Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    START                                     │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
            ┌───────────────────────┐
            │  Parse CLI Arguments  │
            └───────────┬───────────┘
                        │
                        ▼
            ┌───────────────────────┐
            │   Validate URL        │
            └───────────┬───────────┘
                        │
                        ▼
            ┌───────────────────────┐
            │   Load .env Config    │
            └───────────┬───────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   STEP 1: SCRAPING            │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Launch Puppeteer Browser     │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Navigate to Product URL     │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Wait for Page Load          │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Detect Site Type             │
        │   ├─ WordPress?                │
        │   └─ Custom?                   │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│ WordPress     │      │ Custom        │
│ Scraper       │      │ Scraper       │
└───────┬───────┘      └───────┬───────┘
        │                      │
        └──────────┬───────────┘
                   │
                   ▼
        ┌───────────────────────────────┐
        │   Extract Product Data         │
        │   ├─ Name                      │
        │   ├─ Price                     │
        │   ├─ Description               │
        │   ├─ Images                    │
        │   ├─ Categories                │
        │   ├─ Tags                      │
        │   └─ Features (ALL)            │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Close Browser                │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Return productData          │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   STEP 2: UPLOADING            │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Initialize WooCommerce API   │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Process Categories           │
        │   └─ Get first category only   │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Check SKU                    │
        │   ├─ Duplicate? → Skip         │
        │   └─ Unique? → Add             │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Convert Features →           │
        │   Attributes                   │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Build Product Object         │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   POST to WooCommerce API      │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│   Success     │      │   Error       │
│   Return ID   │      │   Handle      │
└───────┬───────┘      └───────┬───────┘
        │                      │
        └──────────┬───────────┘
                   │
                   ▼
        ┌───────────────────────────────┐
        │   Display Results              │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   END                          │
        └───────────────────────────────┘
```

## Site Type Detection Flow

```
┌─────────────────────────────────────────────────────────────┐
│              Page Loaded in Puppeteer                        │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Check for WooCommerce        │
        │   Indicators                   │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│ Found .woo-   │      │ Check wp-     │
│ commerce?     │      │ content?      │
└───────┬───────┘      └───────┬───────┘
        │                      │
        │ Yes                  │ Yes
        ▼                      ▼
┌───────────────┐      ┌───────────────┐
│ WordPress     │      │ WordPress     │
│ Detected      │      │ Detected      │
└───────┬───────┘      └───────┬───────┘
        │                      │
        └──────────┬───────────┘
                   │
                   ▼
        ┌───────────────────────────────┐
        │   Check woocommerce in        │
        │   scripts?                    │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        │ Yes                   │ No
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│ Use WordPress │      │ Use Custom    │
│ Scraper       │      │ Scraper       │
└───────────────┘      └───────────────┘
```

## Feature Extraction Flow

```
┌─────────────────────────────────────────────────────────────┐
│              Feature Extraction Starts                       │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Strategy 1:                  │
        │   Dedicated Features Sections  │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        │ Found                 │ Not Found
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│ Extract from  │      │ Strategy 2:    │
│ <ul>, <ol>    │      │ Text Pattern  │
└───────┬───────┘      └───────┬───────┘
        │                      │
        │                      │ "ویژگی های محصول:"
        │                      │ Found?
        │                      │
        │                      ▼
        │              ┌───────────────┐
        │              │ Extract text  │
        │              │ after pattern │
        │              └───────┬───────┘
        │                      │
        │                      │ Not Found
        │                      ▼
        │              ┌───────────────┐
        │              │ Strategy 3:   │
        │              │ HTML Lists    │
        │              └───────┬───────┘
        │                      │
        │                      │ Found?
        │                      │
        │                      ▼
        │              ┌───────────────┐
        │              │ Strategy 4:   │
        │              │ Features List │
        │              └───────┬───────┘
        │                      │
        │                      │ Found?
        │                      │
        │                      ▼
        │              ┌───────────────┐
        │              │ Strategy 5:   │
        │              │ Short Desc    │
        │              └───────┬───────┘
        │                      │
        │                      │ Found?
        │                      │
        │                      ▼
        │              ┌───────────────┐
        │              │ Strategy 6:   │
        │              │ Desc HTML     │
        │              └───────┬───────┘
        │                      │
        └──────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Clean Features              │
        │   ├─ Remove duplicates        │
        │   ├─ Filter empty             │
        │   └─ Filter invalid           │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Return ALL Features         │
        └───────────────────────────────┘
```

## WooCommerce Upload Flow

```
┌─────────────────────────────────────────────────────────────┐
│              Upload Product Starts                           │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Initialize API Client        │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Process Categories           │
        │   ├─ Get first category        │
        │   ├─ Find existing (don't      │
        │   │   create)                  │
        │   └─ Return category ID        │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Check SKU                    │
        │   ├─ Query existing products   │
        │   ├─ Duplicate found?          │
        │   │   └─ Skip SKU             │
        │   └─ Unique? → Add SKU         │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Convert Features             │
        │   ├─ Create attribute          │
        │   │   "ویژگی های محصول"       │
        │   ├─ Add ALL features as       │
        │   │   options                  │
        │   └─ Set visible: true         │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Build Product Object         │
        │   ├─ Basic info                │
        │   ├─ Prices                    │
        │   ├─ Descriptions              │
        │   ├─ Images                    │
        │   ├─ Categories                │
        │   ├─ Tags                      │
        │   └─ Attributes (features)     │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   POST to WooCommerce API      │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        │ Success               │ Error
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│ Return        │      │ Check Error   │
│ Product ID    │      │ Type          │
└───────────────┘      └───────┬───────┘
                               │
                   ┌───────────┴───────────┐
                   │                       │
                   ▼                       ▼
          ┌───────────────┐      ┌───────────────┐
          │ SKU Duplicate?│      │ Other Error   │
          │ (400)         │      │               │
          └───────┬───────┘      └───────┬───────┘
                  │                      │
                  │ Yes                  │
                  ▼                      ▼
          ┌───────────────┐      ┌───────────────┐
          │ Retry without│      │ Throw Error   │
          │ SKU          │      │               │
          └───────┬───────┘      └───────────────┘
                  │
                  ▼
          ┌───────────────┐
          │ POST again    │
          └───────┬───────┘
                  │
                  ▼
          ┌───────────────┐
          │ Return ID     │
          └───────────────┘
```

## Image Extraction Flow

```
┌─────────────────────────────────────────────────────────────┐
│              Image Extraction Starts                         │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Find Gallery Container       │
        │   ├─ .product-images           │
        │   ├─ .woocommerce-product-      │
        │   │   gallery                  │
        │   └─ Fallback: product         │
        │       container                │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Get All Images in Container  │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Filter Images               │
        │   ├─ Check excluded sections  │
        │   │   (related products)       │
        │   ├─ Check size (width/height)│
        │   ├─ Check URL patterns       │
        │   │   (logo, icon, banner)    │
        │   └─ Check duplicates         │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Convert Relative URLs        │
        │   ├─ // → https:               │
        │   ├─ / → origin + path         │
        │   └─ relative → origin + /path │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Return Image Array          │
        │   [{src: "full_url"}]         │
        └───────────────────────────────┘
```

## Category Processing Flow

```
┌─────────────────────────────────────────────────────────────┐
│              Category Processing Starts                      │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Get First Category Only     │
        │   (Prevent timeout)            │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Search WooCommerce for      │
        │   Category by Name            │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        │ Found                 │ Not Found
        ▼                       ▼
┌───────────────┐      ┌───────────────┐
│ Return        │      │ Log: Category │
│ Category ID   │      │ Not Found     │
│               │      │ (Skip - don't │
│               │      │  create)      │
└───────┬───────┘      └───────┬───────┘
        │                      │
        │                      │ Return null
        └──────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Return Category ID Array    │
        │   [{id: number}] or []        │
        └───────────────────────────────┘
```

## Data Transformation Flow

```
┌─────────────────────────────────────────────────────────────┐
│              Scraped Product Data                           │
│  {                                                           │
│    name: "Product Name",                                     │
│    categories: [{name: "Category"}],                        │
│    features: ["Feature 1", "Feature 2", ...]                │
│  }                                                           │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │   Transform Categories         │
        │   {name: "Cat"} → {id: 123}   │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   Transform Features           │
        │   ["Feat1", "Feat2"] →        │
        │   attributes: [{               │
        │     name: "ویژگی های محصول",  │
        │     options: ["Feat1", ...]   │
        │   }]                          │
        └───────────┬───────────────────┘
                    │
                    ▼
        ┌───────────────────────────────┐
        │   WooCommerce Product Object   │
        │   {                            │
        │     name: "Product Name",      │
        │     categories: [{id: 123}],   │
        │     attributes: [{...}]        │
        │   }                            │
        └───────────────────────────────┘
```

